\hypertarget{decoder_8c}{}\section{decoder.\+c File Reference}
\label{decoder_8c}\index{decoder.\+c@{decoder.\+c}}


Contains functions that implement the \char`\"{}decoders in the encoder\char`\"{} concept for the rate-\/distortion optimization with losses.  


{\ttfamily \#include $<$stdlib.\+h$>$}\\*
{\ttfamily \#include $<$memory.\+h$>$}\\*
{\ttfamily \#include \char`\"{}global.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}refbuf.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}image.\+h\char`\"{}}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{decoder_8c_a7786a7eed4be036d11e9dc801b60d48d}{decode\+\_\+one\+\_\+b8block} (int decoder, int mbmode, int b8block, int b8mode, int b8ref)
\begin{DoxyCompactList}\small\item\em decodes one 8x8 partition \end{DoxyCompactList}\item 
\hypertarget{decoder_8c_a4c13da72c0a128bf0b2fafaad640ace8}{}void \hyperlink{decoder_8c_a4c13da72c0a128bf0b2fafaad640ace8}{decode\+\_\+one\+\_\+mb} (int decoder, Macroblock $\ast$curr\+M\+B)\label{decoder_8c_a4c13da72c0a128bf0b2fafaad640ace8}

\begin{DoxyCompactList}\small\item\em decodes one macroblock \end{DoxyCompactList}\item 
void \hyperlink{decoder_8c_af8b9e42ec4d531471a325b03d627f941}{Get\+\_\+\+Reference\+\_\+\+Block} (byte $\ast$$\ast$im\+Y, int block\+\_\+y, int block\+\_\+x, int mvhor, int mvver, byte $\ast$$\ast$out)
\begin{DoxyCompactList}\small\item\em Finds the reference M\+B given the decoded reference frame. \end{DoxyCompactList}\item 
byte \hyperlink{decoder_8c_ab67b9344853ec0b507fbdeb56a63c407}{Get\+\_\+\+Reference\+\_\+\+Pixel} (byte $\ast$$\ast$im\+Y, int y\+\_\+pos, int x\+\_\+pos)
\begin{DoxyCompactList}\small\item\em Finds a pixel (y,x) of the upsampled reference frame. \end{DoxyCompactList}\item 
\hypertarget{decoder_8c_a8f4ea3b2d267449aff86b529ac5ce748}{}void \hyperlink{decoder_8c_a8f4ea3b2d267449aff86b529ac5ce748}{Update\+Decoders} ()\label{decoder_8c_a8f4ea3b2d267449aff86b529ac5ce748}

\begin{DoxyCompactList}\small\item\em Performs the simulation of the packet losses, calls the error concealment funcs and copies the decoded images to the reference frame buffers of the decoders. \end{DoxyCompactList}\item 
void \hyperlink{decoder_8c_ad6206f231148e8a0634befb6c7359995}{Dec\+One\+Forth\+Pix} (byte $\ast$$\ast$d\+Y, byte $\ast$$\ast$$\ast$dref)
\begin{DoxyCompactList}\small\item\em Copies one (reconstructed) image to the respective reference frame buffer. \end{DoxyCompactList}\item 
\hypertarget{decoder_8c_a73615af5374935a9f2447e7f4c72f285}{}void \hyperlink{decoder_8c_a73615af5374935a9f2447e7f4c72f285}{compute\+\_\+residue\+\_\+b8block} (int b8block, int i16mode)\label{decoder_8c_a73615af5374935a9f2447e7f4c72f285}

\begin{DoxyCompactList}\small\item\em Gives the prediction residue for a 8x8 block. \end{DoxyCompactList}\item 
\hypertarget{decoder_8c_a4adb0618f93a1b6106e4a618f7a3b2df}{}void \hyperlink{decoder_8c_a4adb0618f93a1b6106e4a618f7a3b2df}{compute\+\_\+residue\+\_\+mb} (int i16mode)\label{decoder_8c_a4adb0618f93a1b6106e4a618f7a3b2df}

\begin{DoxyCompactList}\small\item\em Gives the prediction residue for a macroblock. \end{DoxyCompactList}\item 
void \hyperlink{decoder_8c_acb1b61f0c2b0e15504b0c9a2df7a1007}{Build\+\_\+\+Status\+\_\+\+Map} (byte $\ast$$\ast$s\+\_\+map)
\begin{DoxyCompactList}\small\item\em Builds a random status map showing whether each M\+B is received or lost, based on the packet loss rate and the slice structure. \end{DoxyCompactList}\item 
void \hyperlink{decoder_8c_a0073527abfbf6d6baa0f7cf871eacbc2}{Error\+\_\+\+Concealment} (byte $\ast$$\ast$in\+Y, byte $\ast$$\ast$s\+\_\+map, byte $\ast$$\ast$$\ast$ref\+Y)
\begin{DoxyCompactList}\small\item\em Performs some sort of error concealment for the areas that are lost according to the status\+\_\+map. \end{DoxyCompactList}\item 
void \hyperlink{decoder_8c_a4126401e06637c6c3afdc8921eaadbbd}{Conceal\+\_\+\+Error} (byte $\ast$$\ast$in\+Y, int mb\+\_\+y, int mb\+\_\+x, byte $\ast$$\ast$$\ast$ref\+Y, byte $\ast$$\ast$s\+\_\+map)
\begin{DoxyCompactList}\small\item\em Copies a certain M\+B (mb\+\_\+y,mb\+\_\+x) of the frame in\+Y\mbox{[}\mbox{]}\mbox{[}\mbox{]} from the previous frame. For the time there is no better E\+C... \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Contains functions that implement the \char`\"{}decoders in the encoder\char`\"{} concept for the rate-\/distortion optimization with losses. 

\begin{DoxyDate}{Date}
October 22nd, 2001
\end{DoxyDate}
\begin{DoxyAuthor}{Author}
Main contributors (see contributors.\+h for copyright, address and affiliation details)
\begin{DoxyItemize}
\item Dimitrios Kontopodis \href{mailto:dkonto@eikon.tum.de}{\tt dkonto@eikon.\+tum.\+de} 
\end{DoxyItemize}
\end{DoxyAuthor}


\subsection{Function Documentation}
\hypertarget{decoder_8c_acb1b61f0c2b0e15504b0c9a2df7a1007}{}\index{decoder.\+c@{decoder.\+c}!Build\+\_\+\+Status\+\_\+\+Map@{Build\+\_\+\+Status\+\_\+\+Map}}
\index{Build\+\_\+\+Status\+\_\+\+Map@{Build\+\_\+\+Status\+\_\+\+Map}!decoder.\+c@{decoder.\+c}}
\subsubsection[{Build\+\_\+\+Status\+\_\+\+Map(byte $\ast$$\ast$s\+\_\+map)}]{\setlength{\rightskip}{0pt plus 5cm}void Build\+\_\+\+Status\+\_\+\+Map (
\begin{DoxyParamCaption}
\item[{byte $\ast$$\ast$}]{s\+\_\+map}
\end{DoxyParamCaption}
)}\label{decoder_8c_acb1b61f0c2b0e15504b0c9a2df7a1007}


Builds a random status map showing whether each M\+B is received or lost, based on the packet loss rate and the slice structure. 


\begin{DoxyParams}{Parameters}
{\em s\+\_\+map} & The status map to be filled \\
\hline
\end{DoxyParams}
Packet O\+K \hypertarget{decoder_8c_a4126401e06637c6c3afdc8921eaadbbd}{}\index{decoder.\+c@{decoder.\+c}!Conceal\+\_\+\+Error@{Conceal\+\_\+\+Error}}
\index{Conceal\+\_\+\+Error@{Conceal\+\_\+\+Error}!decoder.\+c@{decoder.\+c}}
\subsubsection[{Conceal\+\_\+\+Error(byte $\ast$$\ast$in\+Y, int mb\+\_\+y, int mb\+\_\+x, byte $\ast$$\ast$$\ast$ref\+Y, byte $\ast$$\ast$s\+\_\+map)}]{\setlength{\rightskip}{0pt plus 5cm}void Conceal\+\_\+\+Error (
\begin{DoxyParamCaption}
\item[{byte $\ast$$\ast$}]{in\+Y, }
\item[{int}]{mb\+\_\+y, }
\item[{int}]{mb\+\_\+x, }
\item[{byte $\ast$$\ast$$\ast$}]{ref\+Y, }
\item[{byte $\ast$$\ast$}]{s\+\_\+map}
\end{DoxyParamCaption}
)}\label{decoder_8c_a4126401e06637c6c3afdc8921eaadbbd}


Copies a certain M\+B (mb\+\_\+y,mb\+\_\+x) of the frame in\+Y\mbox{[}\mbox{]}\mbox{[}\mbox{]} from the previous frame. For the time there is no better E\+C... 

whole slice lost (at least partition A lost)

partition B and partition C lost

Copy motion vectors

Residuum ist set to zero

not first frame

if copy mb

if inter mb

first frame; up to now set value to grey, may integrate nokia E\+C

Partition C lost

Copy motion vectors

Residuum ist set to zero

if copy mb

if inter mb

Partition B lost

first frame; up to now set value to grey, may integrate nokia E\+C

End Switch \hypertarget{decoder_8c_a7786a7eed4be036d11e9dc801b60d48d}{}\index{decoder.\+c@{decoder.\+c}!decode\+\_\+one\+\_\+b8block@{decode\+\_\+one\+\_\+b8block}}
\index{decode\+\_\+one\+\_\+b8block@{decode\+\_\+one\+\_\+b8block}!decoder.\+c@{decoder.\+c}}
\subsubsection[{decode\+\_\+one\+\_\+b8block(int decoder, int mbmode, int b8block, int b8mode, int b8ref)}]{\setlength{\rightskip}{0pt plus 5cm}void decode\+\_\+one\+\_\+b8block (
\begin{DoxyParamCaption}
\item[{int}]{decoder, }
\item[{int}]{mbmode, }
\item[{int}]{b8block, }
\item[{int}]{b8mode, }
\item[{int}]{b8ref}
\end{DoxyParamCaption}
)}\label{decoder_8c_a7786a7eed4be036d11e9dc801b60d48d}


decodes one 8x8 partition 

\begin{DoxyNote}{Note}
Gives the expected value in the decoder of one 8x8 block. This is done based on the stored reconstructed residue decs-\/$>$res\+Y\mbox{[}\mbox{]}\mbox{[}\mbox{]}, the reconstructed values img\+Y\mbox{[}\mbox{]}\mbox{[}\mbox{]} and the motion vectors. The decoded 8x8 block is moved to decs-\/$>$dec\+Y\mbox{[}\mbox{]}\mbox{[}\mbox{]}. 
\end{DoxyNote}
\hypertarget{decoder_8c_ad6206f231148e8a0634befb6c7359995}{}\index{decoder.\+c@{decoder.\+c}!Dec\+One\+Forth\+Pix@{Dec\+One\+Forth\+Pix}}
\index{Dec\+One\+Forth\+Pix@{Dec\+One\+Forth\+Pix}!decoder.\+c@{decoder.\+c}}
\subsubsection[{Dec\+One\+Forth\+Pix(byte $\ast$$\ast$d\+Y, byte $\ast$$\ast$$\ast$dref)}]{\setlength{\rightskip}{0pt plus 5cm}void Dec\+One\+Forth\+Pix (
\begin{DoxyParamCaption}
\item[{byte $\ast$$\ast$}]{d\+Y, }
\item[{byte $\ast$$\ast$$\ast$}]{dref}
\end{DoxyParamCaption}
)}\label{decoder_8c_ad6206f231148e8a0634befb6c7359995}


Copies one (reconstructed) image to the respective reference frame buffer. 

\begin{DoxyNote}{Note}
This is used at the \char`\"{}many decoders in the encoder\char`\"{} 
\end{DoxyNote}

\begin{DoxyParams}{Parameters}
{\em d\+Y} & The reconstructed image \\
\hline
{\em dref} & The reference buffer \\
\hline
\end{DoxyParams}
\hypertarget{decoder_8c_a0073527abfbf6d6baa0f7cf871eacbc2}{}\index{decoder.\+c@{decoder.\+c}!Error\+\_\+\+Concealment@{Error\+\_\+\+Concealment}}
\index{Error\+\_\+\+Concealment@{Error\+\_\+\+Concealment}!decoder.\+c@{decoder.\+c}}
\subsubsection[{Error\+\_\+\+Concealment(byte $\ast$$\ast$in\+Y, byte $\ast$$\ast$s\+\_\+map, byte $\ast$$\ast$$\ast$ref\+Y)}]{\setlength{\rightskip}{0pt plus 5cm}void Error\+\_\+\+Concealment (
\begin{DoxyParamCaption}
\item[{byte $\ast$$\ast$}]{in\+Y, }
\item[{byte $\ast$$\ast$}]{s\+\_\+map, }
\item[{byte $\ast$$\ast$$\ast$}]{ref\+Y}
\end{DoxyParamCaption}
)}\label{decoder_8c_a0073527abfbf6d6baa0f7cf871eacbc2}


Performs some sort of error concealment for the areas that are lost according to the status\+\_\+map. 


\begin{DoxyParams}{Parameters}
{\em in\+Y} & Error concealment is performed on this frame im\+Y\mbox{[}\mbox{]}\mbox{[}\mbox{]} \\
\hline
{\em s\+\_\+map} & The status map shows which areas are lost. \\
\hline
{\em ref\+Y} & The set of reference frames -\/ may be used for the error concealment. \\
\hline
\end{DoxyParams}
\hypertarget{decoder_8c_af8b9e42ec4d531471a325b03d627f941}{}\index{decoder.\+c@{decoder.\+c}!Get\+\_\+\+Reference\+\_\+\+Block@{Get\+\_\+\+Reference\+\_\+\+Block}}
\index{Get\+\_\+\+Reference\+\_\+\+Block@{Get\+\_\+\+Reference\+\_\+\+Block}!decoder.\+c@{decoder.\+c}}
\subsubsection[{Get\+\_\+\+Reference\+\_\+\+Block(byte $\ast$$\ast$im\+Y, int block\+\_\+y, int block\+\_\+x, int mvhor, int mvver, byte $\ast$$\ast$out)}]{\setlength{\rightskip}{0pt plus 5cm}void Get\+\_\+\+Reference\+\_\+\+Block (
\begin{DoxyParamCaption}
\item[{byte $\ast$$\ast$}]{im\+Y, }
\item[{int}]{block\+\_\+y, }
\item[{int}]{block\+\_\+x, }
\item[{int}]{mvhor, }
\item[{int}]{mvver, }
\item[{byte $\ast$$\ast$}]{out}
\end{DoxyParamCaption}
)}\label{decoder_8c_af8b9e42ec4d531471a325b03d627f941}


Finds the reference M\+B given the decoded reference frame. 

\begin{DoxyNote}{Note}
This is based on the function Unified\+One\+Forth\+Pix, only it is modified to be used at the \char`\"{}many decoders in the encoder\char`\"{} R\+D optimization. In this case we dont want to keep full upsampled reference frames for all decoders, so we just upsample when it is necessary. 
\end{DoxyNote}

\begin{DoxyParams}{Parameters}
{\em im\+Y} & The frame to be upsampled \\
\hline
{\em block\+\_\+y} & The row of the block, whose prediction we want to find \\
\hline
{\em block\+\_\+x} & The column of the block, whose prediction we want to track \\
\hline
{\em mvhor} & Motion vector, horizontal part \\
\hline
{\em mvver} & Motion vector, vertical part \\
\hline
{\em out} & Output\+: The prediction for the block (block\+\_\+y, block\+\_\+x) \\
\hline
\end{DoxyParams}
\hypertarget{decoder_8c_ab67b9344853ec0b507fbdeb56a63c407}{}\index{decoder.\+c@{decoder.\+c}!Get\+\_\+\+Reference\+\_\+\+Pixel@{Get\+\_\+\+Reference\+\_\+\+Pixel}}
\index{Get\+\_\+\+Reference\+\_\+\+Pixel@{Get\+\_\+\+Reference\+\_\+\+Pixel}!decoder.\+c@{decoder.\+c}}
\subsubsection[{Get\+\_\+\+Reference\+\_\+\+Pixel(byte $\ast$$\ast$im\+Y, int y\+\_\+pos, int x\+\_\+pos)}]{\setlength{\rightskip}{0pt plus 5cm}byte Get\+\_\+\+Reference\+\_\+\+Pixel (
\begin{DoxyParamCaption}
\item[{byte $\ast$$\ast$}]{im\+Y, }
\item[{int}]{y\+\_\+pos, }
\item[{int}]{x\+\_\+pos}
\end{DoxyParamCaption}
)}\label{decoder_8c_ab67b9344853ec0b507fbdeb56a63c407}


Finds a pixel (y,x) of the upsampled reference frame. 

\begin{DoxyNote}{Note}
This is based on the function Unified\+One\+Forth\+Pix, only it is modified to be used at the \char`\"{}many decoders in the encoder\char`\"{} R\+D optimization. In this case we dont want to keep full upsampled reference frames for all decoders, so we just upsample when it is necessary. 
\end{DoxyNote}

\hypertarget{parset_8c}{}\section{parset.\+c File Reference}
\label{parset_8c}\index{parset.\+c@{parset.\+c}}


Picture and Sequence Parameter set generation and handling.  


{\ttfamily \#include $<$assert.\+h$>$}\\*
{\ttfamily \#include $<$stdio.\+h$>$}\\*
{\ttfamily \#include $<$stdlib.\+h$>$}\\*
{\ttfamily \#include $<$memory.\+h$>$}\\*
{\ttfamily \#include $<$malloc.\+h$>$}\\*
{\ttfamily \#include $<$string.\+h$>$}\\*
{\ttfamily \#include \char`\"{}global.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}contributors.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}parsetcommon.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}nalu.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}parset.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}fmo.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}vlc.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}mbuffer.\+h\char`\"{}}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{parset_8c_a4f3d2bb7e7970f24b1f5c2e86aefabcb}{Generate\+Parameter\+Sets} ()
\begin{DoxyCompactList}\small\item\em generates a sequence and picture parameter set and stores these in global active\+\_\+sps and active\+\_\+pps \end{DoxyCompactList}\item 
void \hyperlink{parset_8c_a2a31602a3ebbedf60e8963bf1bd8e1be}{Free\+Parameter\+Sets} ()
\begin{DoxyCompactList}\small\item\em frees global parameter sets active\+\_\+sps and active\+\_\+pps \end{DoxyCompactList}\item 
N\+A\+L\+U\+\_\+t $\ast$ \hyperlink{parset_8c_a2758c89416acfb769f1fdd74e750ee1b}{Generate\+Seq\+\_\+parameter\+\_\+set\+\_\+\+N\+A\+L\+U} ()
\begin{DoxyCompactList}\small\item\em int Generate\+Seq\+\_\+parameter\+\_\+set\+\_\+\+N\+A\+L\+U (); \end{DoxyCompactList}\item 
N\+A\+L\+U\+\_\+t $\ast$ \hyperlink{parset_8c_a4cf018768a067fec68b97e027ecd3819}{Generate\+Pic\+\_\+parameter\+\_\+set\+\_\+\+N\+A\+L\+U} ()
\begin{DoxyCompactList}\small\item\em N\+A\+L\+U\+\_\+t $\ast$\+Generate\+Pic\+\_\+parameter\+\_\+set\+\_\+\+N\+A\+L\+U ();. \end{DoxyCompactList}\item 
void \hyperlink{parset_8c_a8c2ef325f78e6851fba3ed4032be8c50}{Fill\+Parameter\+Set\+Structures} (seq\+\_\+parameter\+\_\+set\+\_\+rbsp\+\_\+t $\ast$sps, pic\+\_\+parameter\+\_\+set\+\_\+rbsp\+\_\+t $\ast$pps)
\begin{DoxyCompactList}\small\item\em Fill\+Parameter\+Set\+Structures\+: extracts info from global variables and generates a picture and sequence parameter set structure. \end{DoxyCompactList}\item 
int \hyperlink{parset_8c_aa54abd2ecf70d3d51ef613387e5dba91}{Generate\+Seq\+\_\+parameter\+\_\+set\+\_\+rbsp} (seq\+\_\+parameter\+\_\+set\+\_\+rbsp\+\_\+t $\ast$sps, char $\ast$rbsp)
\begin{DoxyCompactList}\small\item\em int Generate\+Seq\+\_\+parameter\+\_\+set\+\_\+rbsp (seq\+\_\+parameter\+\_\+set\+\_\+rbsp\+\_\+t $\ast$sps, char $\ast$rbsp); \end{DoxyCompactList}\item 
int \hyperlink{parset_8c_af4306d13e672a745606a9793df4b18d5}{Generate\+Pic\+\_\+parameter\+\_\+set\+\_\+rbsp} (pic\+\_\+parameter\+\_\+set\+\_\+rbsp\+\_\+t $\ast$pps, char $\ast$rbsp)
\begin{DoxyCompactList}\small\item\em int Generate\+Pic\+\_\+parameter\+\_\+set\+\_\+rbsp (pic\+\_\+parameter\+\_\+set\+\_\+rbsp\+\_\+t $\ast$sps, char $\ast$rbsp); \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hypertarget{parset_8c_a6cb19d3cc47256c79bf137a84f316255}{}Colocated\+Params $\ast$ {\bfseries Co\+\_\+located}\label{parset_8c_a6cb19d3cc47256c79bf137a84f316255}

\end{DoxyCompactItemize}


\subsection{Detailed Description}
Picture and Sequence Parameter set generation and handling. 

\hyperlink{parset_8c}{parset.\+c} \begin{DoxyDate}{Date}
25 November 2002 
\end{DoxyDate}
\begin{DoxyAuthor}{Author}
Main contributors (see contributors.\+h for copyright, address and affiliation details)
\begin{DoxyItemize}
\item Stephan Wenger \href{mailto:stewe@cs.tu-berlin.de}{\tt stewe@cs.\+tu-\/berlin.\+de} 
\end{DoxyItemize}
\end{DoxyAuthor}


\subsection{Function Documentation}
\hypertarget{parset_8c_a8c2ef325f78e6851fba3ed4032be8c50}{}\index{parset.\+c@{parset.\+c}!Fill\+Parameter\+Set\+Structures@{Fill\+Parameter\+Set\+Structures}}
\index{Fill\+Parameter\+Set\+Structures@{Fill\+Parameter\+Set\+Structures}!parset.\+c@{parset.\+c}}
\subsubsection[{Fill\+Parameter\+Set\+Structures(seq\+\_\+parameter\+\_\+set\+\_\+rbsp\+\_\+t $\ast$sps, pic\+\_\+parameter\+\_\+set\+\_\+rbsp\+\_\+t $\ast$pps)}]{\setlength{\rightskip}{0pt plus 5cm}void Fill\+Parameter\+Set\+Structures (
\begin{DoxyParamCaption}
\item[{seq\+\_\+parameter\+\_\+set\+\_\+rbsp\+\_\+t $\ast$}]{sps, }
\item[{pic\+\_\+parameter\+\_\+set\+\_\+rbsp\+\_\+t $\ast$}]{pps}
\end{DoxyParamCaption}
)}\label{parset_8c_a8c2ef325f78e6851fba3ed4032be8c50}


Fill\+Parameter\+Set\+Structures\+: extracts info from global variables and generates a picture and sequence parameter set structure. 


\begin{DoxyParams}{Parameters}
{\em sps} & Sequence parameter set to be filled \\
\hline
{\em pps} & Picture parameter set to be filled \\
\hline
\end{DoxyParams}
\begin{DoxyParagraph}{}
Function reads all kinds of values from several global variables, including input-\/$>$ and image-\/$>$ and fills in the sps and pps. Many values are current hard-\/coded to defaults, especially most of the V\+U\+I stuff. Currently, the sps and pps structures are fixed length with the exception of the fully flexible F\+M\+O map (mode 6). This mode is not supported. Hence, the function does not need to allocate memory for the F\+M\+Omap, the pointer slice\+\_\+group\+\_\+id is always N\+U\+L\+L. If one wants to implement F\+M\+O mode 6, one would need to malloc the memory for the map here, and the caller would need to free it after use.
\end{DoxyParagraph}
\begin{DoxyParagraph}{}
Limitations Currently, the encoder does not support multiple parameter sets, primarily because the config file does not support it. Hence the pic\+\_\+parameter\+\_\+set\+\_\+id and the seq\+\_\+parameter\+\_\+set\+\_\+id are always zero. If one day multiple parameter sets are implemented, it would make sense to break this function into two, one for the picture and one for the sequence. Currently, F\+M\+O is not supported The following pps and sps elements seem not to be used in the encoder or decoder and, hence, a guessed default value is conveyed\+:
\end{DoxyParagraph}
pps-\/$>$num\+\_\+ref\+\_\+idx\+\_\+l0\+\_\+active\+\_\+minus1 = img-\/$>$num\+\_\+ref\+\_\+pic\+\_\+active\+\_\+fwd\+\_\+minus1; pps-\/$>$num\+\_\+ref\+\_\+idx\+\_\+l1\+\_\+active\+\_\+minus1 = img-\/$>$num\+\_\+ref\+\_\+pic\+\_\+active\+\_\+bwd\+\_\+minus1; pps-\/$>$chroma\+\_\+qp\+\_\+index\+\_\+offset = 0; sps-\/$>$required\+\_\+frame\+\_\+num\+\_\+update\+\_\+behaviour\+\_\+flag = F\+A\+L\+S\+E; sps-\/$>$direct\+\_\+temporal\+\_\+constrained\+\_\+flag = F\+A\+L\+S\+E;

\begin{DoxyParagraph}{}
Regarding the Q\+P The previous software versions coded the absolute Q\+P only in the slice header. This is kept, and the offset in the P\+P\+S is coded even if we could save bits by intelligently using this field. 
\end{DoxyParagraph}
P\+O\+C stuff\+: The following values are hard-\/coded in \hyperlink{lencod_8c_a6190a603712b3dc9c878f54a8f7b325b}{init\+\_\+poc()}. Apparently, the poc implementation covers only a subset of the poc functionality. Here, the same subset is implemented. Changes in the P\+O\+C stuff have also to be reflected here

Following set the parameter for different slice group types \hypertarget{parset_8c_a2a31602a3ebbedf60e8963bf1bd8e1be}{}\index{parset.\+c@{parset.\+c}!Free\+Parameter\+Sets@{Free\+Parameter\+Sets}}
\index{Free\+Parameter\+Sets@{Free\+Parameter\+Sets}!parset.\+c@{parset.\+c}}
\subsubsection[{Free\+Parameter\+Sets()}]{\setlength{\rightskip}{0pt plus 5cm}void Free\+Parameter\+Sets (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{parset_8c_a2a31602a3ebbedf60e8963bf1bd8e1be}


frees global parameter sets active\+\_\+sps and active\+\_\+pps 

\begin{DoxyReturn}{Returns}
A N\+A\+L\+U containing the Sequence Parameter\+Set 
\end{DoxyReturn}
\hypertarget{parset_8c_a4f3d2bb7e7970f24b1f5c2e86aefabcb}{}\index{parset.\+c@{parset.\+c}!Generate\+Parameter\+Sets@{Generate\+Parameter\+Sets}}
\index{Generate\+Parameter\+Sets@{Generate\+Parameter\+Sets}!parset.\+c@{parset.\+c}}
\subsubsection[{Generate\+Parameter\+Sets()}]{\setlength{\rightskip}{0pt plus 5cm}void Generate\+Parameter\+Sets (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{parset_8c_a4f3d2bb7e7970f24b1f5c2e86aefabcb}


generates a sequence and picture parameter set and stores these in global active\+\_\+sps and active\+\_\+pps 

\begin{DoxyReturn}{Returns}
A N\+A\+L\+U containing the Sequence Parameter\+Set 
\end{DoxyReturn}
\hypertarget{parset_8c_a4cf018768a067fec68b97e027ecd3819}{}\index{parset.\+c@{parset.\+c}!Generate\+Pic\+\_\+parameter\+\_\+set\+\_\+\+N\+A\+L\+U@{Generate\+Pic\+\_\+parameter\+\_\+set\+\_\+\+N\+A\+L\+U}}
\index{Generate\+Pic\+\_\+parameter\+\_\+set\+\_\+\+N\+A\+L\+U@{Generate\+Pic\+\_\+parameter\+\_\+set\+\_\+\+N\+A\+L\+U}!parset.\+c@{parset.\+c}}
\subsubsection[{Generate\+Pic\+\_\+parameter\+\_\+set\+\_\+\+N\+A\+L\+U()}]{\setlength{\rightskip}{0pt plus 5cm}N\+A\+L\+U\+\_\+t$\ast$ Generate\+Pic\+\_\+parameter\+\_\+set\+\_\+\+N\+A\+L\+U (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{parset_8c_a4cf018768a067fec68b97e027ecd3819}


N\+A\+L\+U\+\_\+t $\ast$\+Generate\+Pic\+\_\+parameter\+\_\+set\+\_\+\+N\+A\+L\+U ();. 

\begin{DoxyNote}{Note}
Uses the global variables through \hyperlink{parset_8c_a8c2ef325f78e6851fba3ed4032be8c50}{Fill\+Parameter\+Set\+Structures()}
\end{DoxyNote}
\begin{DoxyReturn}{Returns}
A N\+A\+L\+U containing the Picture Parameter Set 
\end{DoxyReturn}
\hypertarget{parset_8c_af4306d13e672a745606a9793df4b18d5}{}\index{parset.\+c@{parset.\+c}!Generate\+Pic\+\_\+parameter\+\_\+set\+\_\+rbsp@{Generate\+Pic\+\_\+parameter\+\_\+set\+\_\+rbsp}}
\index{Generate\+Pic\+\_\+parameter\+\_\+set\+\_\+rbsp@{Generate\+Pic\+\_\+parameter\+\_\+set\+\_\+rbsp}!parset.\+c@{parset.\+c}}
\subsubsection[{Generate\+Pic\+\_\+parameter\+\_\+set\+\_\+rbsp(pic\+\_\+parameter\+\_\+set\+\_\+rbsp\+\_\+t $\ast$pps, char $\ast$rbsp)}]{\setlength{\rightskip}{0pt plus 5cm}int Generate\+Pic\+\_\+parameter\+\_\+set\+\_\+rbsp (
\begin{DoxyParamCaption}
\item[{pic\+\_\+parameter\+\_\+set\+\_\+rbsp\+\_\+t $\ast$}]{pps, }
\item[{char $\ast$}]{rbsp}
\end{DoxyParamCaption}
)}\label{parset_8c_af4306d13e672a745606a9793df4b18d5}


int Generate\+Pic\+\_\+parameter\+\_\+set\+\_\+rbsp (pic\+\_\+parameter\+\_\+set\+\_\+rbsp\+\_\+t $\ast$sps, char $\ast$rbsp); 


\begin{DoxyParams}{Parameters}
{\em pps} & picture parameter structure \\
\hline
{\em rbsp} & buffer to be filled with the rbsp, size should be at least M\+A\+X\+I\+M\+U\+M\+P\+A\+R\+S\+E\+T\+R\+B\+S\+P\+S\+I\+Z\+E\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
size of the R\+B\+S\+P in bytes, negative in case of an error
\end{DoxyReturn}
\begin{DoxyNote}{Note}
Picture Parameter V\+U\+I function is called, but the function implements an exit (-\/1) 
\end{DoxyNote}
\hypertarget{parset_8c_a2758c89416acfb769f1fdd74e750ee1b}{}\index{parset.\+c@{parset.\+c}!Generate\+Seq\+\_\+parameter\+\_\+set\+\_\+\+N\+A\+L\+U@{Generate\+Seq\+\_\+parameter\+\_\+set\+\_\+\+N\+A\+L\+U}}
\index{Generate\+Seq\+\_\+parameter\+\_\+set\+\_\+\+N\+A\+L\+U@{Generate\+Seq\+\_\+parameter\+\_\+set\+\_\+\+N\+A\+L\+U}!parset.\+c@{parset.\+c}}
\subsubsection[{Generate\+Seq\+\_\+parameter\+\_\+set\+\_\+\+N\+A\+L\+U()}]{\setlength{\rightskip}{0pt plus 5cm}N\+A\+L\+U\+\_\+t$\ast$ Generate\+Seq\+\_\+parameter\+\_\+set\+\_\+\+N\+A\+L\+U (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{parset_8c_a2758c89416acfb769f1fdd74e750ee1b}


int Generate\+Seq\+\_\+parameter\+\_\+set\+\_\+\+N\+A\+L\+U (); 

\begin{DoxyNote}{Note}
Uses the global variables through \hyperlink{parset_8c_a8c2ef325f78e6851fba3ed4032be8c50}{Fill\+Parameter\+Set\+Structures()}
\end{DoxyNote}
\begin{DoxyReturn}{Returns}
A N\+A\+L\+U containing the Sequence Parameter\+Set 
\end{DoxyReturn}
\hypertarget{parset_8c_aa54abd2ecf70d3d51ef613387e5dba91}{}\index{parset.\+c@{parset.\+c}!Generate\+Seq\+\_\+parameter\+\_\+set\+\_\+rbsp@{Generate\+Seq\+\_\+parameter\+\_\+set\+\_\+rbsp}}
\index{Generate\+Seq\+\_\+parameter\+\_\+set\+\_\+rbsp@{Generate\+Seq\+\_\+parameter\+\_\+set\+\_\+rbsp}!parset.\+c@{parset.\+c}}
\subsubsection[{Generate\+Seq\+\_\+parameter\+\_\+set\+\_\+rbsp(seq\+\_\+parameter\+\_\+set\+\_\+rbsp\+\_\+t $\ast$sps, char $\ast$rbsp)}]{\setlength{\rightskip}{0pt plus 5cm}int Generate\+Seq\+\_\+parameter\+\_\+set\+\_\+rbsp (
\begin{DoxyParamCaption}
\item[{seq\+\_\+parameter\+\_\+set\+\_\+rbsp\+\_\+t $\ast$}]{sps, }
\item[{char $\ast$}]{rbsp}
\end{DoxyParamCaption}
)}\label{parset_8c_aa54abd2ecf70d3d51ef613387e5dba91}


int Generate\+Seq\+\_\+parameter\+\_\+set\+\_\+rbsp (seq\+\_\+parameter\+\_\+set\+\_\+rbsp\+\_\+t $\ast$sps, char $\ast$rbsp); 


\begin{DoxyParams}{Parameters}
{\em sps} & sequence parameter structure \\
\hline
{\em rbsp} & buffer to be filled with the rbsp, size should be at least M\+A\+X\+I\+M\+U\+M\+P\+A\+R\+S\+E\+T\+R\+B\+S\+P\+S\+I\+Z\+E rbsp \+: 没有初始化的一字符数组 \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
size of the R\+B\+S\+P in bytes
\end{DoxyReturn}
\begin{DoxyNote}{Note}
Sequence Parameter V\+U\+I function is called, but the function implements an exit (-\/1) 
\end{DoxyNote}

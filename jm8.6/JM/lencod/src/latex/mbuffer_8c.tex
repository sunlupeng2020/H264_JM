\hypertarget{mbuffer_8c}{}\section{mbuffer.\+c File Reference}
\label{mbuffer_8c}\index{mbuffer.\+c@{mbuffer.\+c}}


Frame buffer functions.  


{\ttfamily \#include $<$stdlib.\+h$>$}\\*
{\ttfamily \#include $<$assert.\+h$>$}\\*
{\ttfamily \#include $<$limits.\+h$>$}\\*
{\ttfamily \#include $<$string.\+h$>$}\\*
{\ttfamily \#include \char`\"{}global.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}mbuffer.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}memalloc.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}output.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}image.\+h\char`\"{}}\\*
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\hypertarget{mbuffer_8c_a52a03eea6b90f6bc967ed15a7e6a36b9}{}\#define {\bfseries M\+A\+X\+\_\+\+L\+I\+S\+T\+\_\+\+S\+I\+Z\+E}~33\label{mbuffer_8c_a52a03eea6b90f6bc967ed15a7e6a36b9}

\item 
\hypertarget{mbuffer_8c_a1382f17b1b086d6bf4781c81c39a5d2e}{}\#define {\bfseries R\+S\+D}(x)~((x\&2)?(x$\vert$1)\+:(x\&($\sim$1)))\label{mbuffer_8c_a1382f17b1b086d6bf4781c81c39a5d2e}

\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{mbuffer_8c_a30268ef8c9ffd2a0bd884e31a9ce2322}{gen\+\_\+field\+\_\+ref\+\_\+ids} (Storable\+Picture $\ast$p)
\item 
\hypertarget{mbuffer_8c_a4c19886743e1a5f346f0786a07aba2a9}{}void \hyperlink{mbuffer_8c_a4c19886743e1a5f346f0786a07aba2a9}{dump\+\_\+dpb} ()\label{mbuffer_8c_a4c19886743e1a5f346f0786a07aba2a9}

\begin{DoxyCompactList}\small\item\em Print out list of pictures in D\+P\+B. Used for debug purposes. \end{DoxyCompactList}\item 
\hypertarget{mbuffer_8c_a71e2c56af73479555a7532ee6b6a3763}{}int \hyperlink{mbuffer_8c_a71e2c56af73479555a7532ee6b6a3763}{get\+Dpb\+Size} ()\label{mbuffer_8c_a71e2c56af73479555a7532ee6b6a3763}

\begin{DoxyCompactList}\small\item\em Returns the size of the dpb depending on level and picture size. \end{DoxyCompactList}\item 
\hypertarget{mbuffer_8c_af6f55781dcefc5cbbffee14b6bcca5ed}{}void \hyperlink{mbuffer_8c_af6f55781dcefc5cbbffee14b6bcca5ed}{init\+\_\+dpb} ()\label{mbuffer_8c_af6f55781dcefc5cbbffee14b6bcca5ed}

\begin{DoxyCompactList}\small\item\em Allocate memory for decoded picture buffer and initialize with sane values. 初始化话解码图片缓冲区 \end{DoxyCompactList}\item 
\hypertarget{mbuffer_8c_af4f1c694a8c4f1f7d8e82efea8f5fe95}{}void \hyperlink{mbuffer_8c_af4f1c694a8c4f1f7d8e82efea8f5fe95}{free\+\_\+dpb} ()\label{mbuffer_8c_af4f1c694a8c4f1f7d8e82efea8f5fe95}

\begin{DoxyCompactList}\small\item\em Free memory for decoded picture buffer. \end{DoxyCompactList}\item 
Frame\+Store $\ast$ \hyperlink{mbuffer_8c_a56f04e14a4e6ffb45cfa6f4aa3f8d9a9}{alloc\+\_\+frame\+\_\+store} ()
\begin{DoxyCompactList}\small\item\em Allocate memory for decoded picture buffer frame stores an initialize with sane values. \end{DoxyCompactList}\item 
Storable\+Picture $\ast$ \hyperlink{mbuffer_8c_a548c12fb881b223ce2535bf0907af9e1}{alloc\+\_\+storable\+\_\+picture} (Picture\+Structure structure, int size\+\_\+x, int size\+\_\+y, int size\+\_\+x\+\_\+cr, int size\+\_\+y\+\_\+cr)
\begin{DoxyCompactList}\small\item\em Allocate memory for a stored picture. \end{DoxyCompactList}\item 
void \hyperlink{mbuffer_8c_a6715a0198eeda7f13ee7c47c8070b6a1}{free\+\_\+frame\+\_\+store} (Frame\+Store $\ast$\hyperlink{rtp_8c_a3efb0e1a16208deecbd84c15401f7cf8}{f})
\begin{DoxyCompactList}\small\item\em Free frame store memory. \end{DoxyCompactList}\item 
void \hyperlink{mbuffer_8c_aa35eaa44fd3013b28c700490f5ed1ac9}{free\+\_\+storable\+\_\+picture} (Storable\+Picture $\ast$p)
\begin{DoxyCompactList}\small\item\em Free picture memory. \end{DoxyCompactList}\item 
\hypertarget{mbuffer_8c_ad0c9f963da1fc73fb3dbc58405f3d4a0}{}int \hyperlink{mbuffer_8c_ad0c9f963da1fc73fb3dbc58405f3d4a0}{is\+\_\+short\+\_\+ref} (Storable\+Picture $\ast$s)\label{mbuffer_8c_ad0c9f963da1fc73fb3dbc58405f3d4a0}

\begin{DoxyCompactList}\small\item\em returns true, if picture is short term reference picture \end{DoxyCompactList}\item 
\hypertarget{mbuffer_8c_abf58af6b42a28a2196d6da5eb9ac6327}{}int \hyperlink{mbuffer_8c_abf58af6b42a28a2196d6da5eb9ac6327}{is\+\_\+long\+\_\+ref} (Storable\+Picture $\ast$s)\label{mbuffer_8c_abf58af6b42a28a2196d6da5eb9ac6327}

\begin{DoxyCompactList}\small\item\em returns true, if picture is long term reference picture \end{DoxyCompactList}\item 
void \hyperlink{mbuffer_8c_a96a96f7b721d3ac5df4228496bc5a2eb}{init\+\_\+lists} (int curr\+Slice\+Type, Picture\+Structure curr\+Pic\+Structure)
\begin{DoxyCompactList}\small\item\em Initialize list\+X\mbox{[}0\mbox{]} and list 1 depending on current picture type. \end{DoxyCompactList}\item 
\hypertarget{mbuffer_8c_a7981c343553ced616e46affdd6b2d5f4}{}void \hyperlink{mbuffer_8c_a7981c343553ced616e46affdd6b2d5f4}{init\+\_\+mbaff\+\_\+lists} ()\label{mbuffer_8c_a7981c343553ced616e46affdd6b2d5f4}

\begin{DoxyCompactList}\small\item\em Initilaize list\+X\mbox{[}2..5\mbox{]} from lists 0 and 1 list\+X\mbox{[}2\mbox{]}\+: list0 for current\+\_\+field==top list\+X\mbox{[}3\mbox{]}\+: list1 for current\+\_\+field==top list\+X\mbox{[}4\mbox{]}\+: list0 for current\+\_\+field==bottom list\+X\mbox{[}5\mbox{]}\+: list1 for current\+\_\+field==bottom. \end{DoxyCompactList}\item 
\hypertarget{mbuffer_8c_ae5492cf4411b5edd5e61a3423dafec89}{}void \hyperlink{mbuffer_8c_ae5492cf4411b5edd5e61a3423dafec89}{reorder\+\_\+ref\+\_\+pic\+\_\+list} (Storable\+Picture $\ast$$\ast$list, int $\ast$list\+\_\+size, int num\+\_\+ref\+\_\+idx\+\_\+l\+X\+\_\+active\+\_\+minus1, int $\ast$remapping\+\_\+of\+\_\+pic\+\_\+nums\+\_\+idc, int $\ast$abs\+\_\+diff\+\_\+pic\+\_\+num\+\_\+minus1, int $\ast$long\+\_\+term\+\_\+pic\+\_\+idx)\label{mbuffer_8c_ae5492cf4411b5edd5e61a3423dafec89}

\begin{DoxyCompactList}\small\item\em Reordering process for reference picture lists. \end{DoxyCompactList}\item 
\hypertarget{mbuffer_8c_a38b9e47d6060ae19fd42a77f39ad3e10}{}void \hyperlink{mbuffer_8c_a38b9e47d6060ae19fd42a77f39ad3e10}{update\+\_\+ref\+\_\+list} ()\label{mbuffer_8c_a38b9e47d6060ae19fd42a77f39ad3e10}

\begin{DoxyCompactList}\small\item\em Update the list of frame stores that contain reference frames/fields. \end{DoxyCompactList}\item 
\hypertarget{mbuffer_8c_aecda06cffeb8bdcb5bb20c2739be599e}{}void \hyperlink{mbuffer_8c_aecda06cffeb8bdcb5bb20c2739be599e}{update\+\_\+ltref\+\_\+list} ()\label{mbuffer_8c_aecda06cffeb8bdcb5bb20c2739be599e}

\begin{DoxyCompactList}\small\item\em Update the list of frame stores that contain long-\/term reference frames/fields. \end{DoxyCompactList}\item 
\hypertarget{mbuffer_8c_a7b653d00d192ce148975b4ee1502c9f9}{}void \hyperlink{mbuffer_8c_a7b653d00d192ce148975b4ee1502c9f9}{mm\+\_\+update\+\_\+max\+\_\+long\+\_\+term\+\_\+frame\+\_\+idx} (int max\+\_\+long\+\_\+term\+\_\+frame\+\_\+idx\+\_\+plus1)\label{mbuffer_8c_a7b653d00d192ce148975b4ee1502c9f9}

\begin{DoxyCompactList}\small\item\em Set new max long\+\_\+term\+\_\+frame\+\_\+idx. \end{DoxyCompactList}\item 
void \hyperlink{mbuffer_8c_a1aa9e438cb3df3236e74bd1d8ca3c98f}{store\+\_\+picture\+\_\+in\+\_\+dpb} (Storable\+Picture $\ast$p)
\begin{DoxyCompactList}\small\item\em Store a picture in D\+P\+B. This includes cheking for space in D\+P\+B and flushing frames. If we received a frame, we need to check for a new store, if we got a field, check if it\textquotesingle{}s the second field of an already allocated store. \end{DoxyCompactList}\item 
void \hyperlink{mbuffer_8c_adf69a2ea97d75495124310f83b485be1}{replace\+\_\+top\+\_\+pic\+\_\+with\+\_\+frame} (Storable\+Picture $\ast$p)
\begin{DoxyCompactList}\small\item\em Insert the frame picture into the if the top field has already been stored for the coding decision. \end{DoxyCompactList}\item 
\hypertarget{mbuffer_8c_a94cfe71d18d6b010c9de3a9850dfa760}{}void \hyperlink{mbuffer_8c_a94cfe71d18d6b010c9de3a9850dfa760}{flush\+\_\+dpb} ()\label{mbuffer_8c_a94cfe71d18d6b010c9de3a9850dfa760}

\begin{DoxyCompactList}\small\item\em All stored picture are output. Should be called to empty the buffer. \end{DoxyCompactList}\item 
void \hyperlink{mbuffer_8c_a2b1e4bbf49d5c3eaf338c9431a8795c8}{dpb\+\_\+split\+\_\+field} (Frame\+Store $\ast$fs)
\begin{DoxyCompactList}\small\item\em Extract top field from a frame. \end{DoxyCompactList}\item 
void \hyperlink{mbuffer_8c_a1020d2ddbd63e87f5b9f186fb2937c04}{dpb\+\_\+combine\+\_\+field} (Frame\+Store $\ast$fs)
\begin{DoxyCompactList}\small\item\em Generate a frame from top and bottom fields. \end{DoxyCompactList}\item 
\hypertarget{mbuffer_8c_aa7a7b98374d90c896425575fafb7b2bf}{}void \hyperlink{mbuffer_8c_aa7a7b98374d90c896425575fafb7b2bf}{alloc\+\_\+ref\+\_\+pic\+\_\+list\+\_\+reordering\+\_\+buffer} (Slice $\ast$curr\+Slice)\label{mbuffer_8c_aa7a7b98374d90c896425575fafb7b2bf}

\begin{DoxyCompactList}\small\item\em Allocate memory for buffering of reference picture reordering commands. \end{DoxyCompactList}\item 
\hypertarget{mbuffer_8c_a1d6adf5e29710c67961f636d947efa61}{}void \hyperlink{mbuffer_8c_a1d6adf5e29710c67961f636d947efa61}{free\+\_\+ref\+\_\+pic\+\_\+list\+\_\+reordering\+\_\+buffer} (Slice $\ast$curr\+Slice)\label{mbuffer_8c_a1d6adf5e29710c67961f636d947efa61}

\begin{DoxyCompactList}\small\item\em Free memory for buffering of reference picture reordering commands. \end{DoxyCompactList}\item 
void \hyperlink{mbuffer_8c_a5d12fb80e39e0072730217ee5083b51c}{fill\+\_\+frame\+\_\+num\+\_\+gap} (Image\+Parameters $\ast$img)
\begin{DoxyCompactList}\small\item\em Tian Dong June 13, 2002, Modifed on July 30, 2003. \end{DoxyCompactList}\item 
Colocated\+Params $\ast$ \hyperlink{mbuffer_8c_a2959632683c970196466f76f36361b66}{alloc\+\_\+colocated} (int size\+\_\+x, int size\+\_\+y, int mb\+\_\+adaptive\+\_\+frame\+\_\+field\+\_\+flag)
\begin{DoxyCompactList}\small\item\em Allocate co-\/located memory. \end{DoxyCompactList}\item 
void \hyperlink{mbuffer_8c_a45d036150b93760d3439e6507b2b7f45}{free\+\_\+collocated} (Colocated\+Params $\ast$p)
\begin{DoxyCompactList}\small\item\em Free co-\/located memory. \end{DoxyCompactList}\item 
void \hyperlink{mbuffer_8c_af05684dfb01eca59a30b057773f86113}{compute\+\_\+collocated} (Colocated\+Params $\ast$p, Storable\+Picture $\ast$$\ast$list\+X\mbox{[}6\mbox{]})
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hypertarget{mbuffer_8c_a444fd24a372d073b6ff73dbe6cef5583}{}Decoded\+Picture\+Buffer {\bfseries dpb}\label{mbuffer_8c_a444fd24a372d073b6ff73dbe6cef5583}

\item 
\hypertarget{mbuffer_8c_abd7256d85cbd4360fa33a1a6c62a5c8e}{}Storable\+Picture $\ast$$\ast$ {\bfseries list\+X} \mbox{[}6\mbox{]}\label{mbuffer_8c_abd7256d85cbd4360fa33a1a6c62a5c8e}

\item 
\hypertarget{mbuffer_8c_a6cb19d3cc47256c79bf137a84f316255}{}Colocated\+Params $\ast$ {\bfseries Co\+\_\+located} = N\+U\+L\+L\label{mbuffer_8c_a6cb19d3cc47256c79bf137a84f316255}

\item 
\hypertarget{mbuffer_8c_ab89a6a08f04cda960ed340413805ec9c}{}int {\bfseries list\+Xsize} \mbox{[}6\mbox{]}\label{mbuffer_8c_ab89a6a08f04cda960ed340413805ec9c}

\end{DoxyCompactItemize}


\subsection{Detailed Description}
Frame buffer functions. 

\hyperlink{mbuffer_8c}{mbuffer.\+c}

\begin{DoxyAuthor}{Author}
Main contributors (see contributors.\+h for copyright, address and affiliation details)
\begin{DoxyItemize}
\item Karsten Shring \href{mailto:suehring@hhi.de}{\tt suehring@hhi.\+de}
\item Alexis Tourapis \href{mailto:alexismt@ieee.org}{\tt alexismt@ieee.\+org} 
\end{DoxyItemize}
\end{DoxyAuthor}


\subsection{Function Documentation}
\hypertarget{mbuffer_8c_a2959632683c970196466f76f36361b66}{}\index{mbuffer.\+c@{mbuffer.\+c}!alloc\+\_\+colocated@{alloc\+\_\+colocated}}
\index{alloc\+\_\+colocated@{alloc\+\_\+colocated}!mbuffer.\+c@{mbuffer.\+c}}
\subsubsection[{alloc\+\_\+colocated(int size\+\_\+x, int size\+\_\+y, int mb\+\_\+adaptive\+\_\+frame\+\_\+field\+\_\+flag)}]{\setlength{\rightskip}{0pt plus 5cm}Colocated\+Params$\ast$ alloc\+\_\+colocated (
\begin{DoxyParamCaption}
\item[{int}]{size\+\_\+x, }
\item[{int}]{size\+\_\+y, }
\item[{int}]{mb\+\_\+adaptive\+\_\+frame\+\_\+field\+\_\+flag}
\end{DoxyParamCaption}
)}\label{mbuffer_8c_a2959632683c970196466f76f36361b66}


Allocate co-\/located memory. 


\begin{DoxyParams}{Parameters}
{\em structure} & picture structure \\
\hline
{\em size\+\_\+x} & horizontal luma size \\
\hline
{\em size\+\_\+y} & vertical luma size \\
\hline
{\em size\+\_\+x\+\_\+cr} & horizontal chroma size \\
\hline
{\em size\+\_\+y\+\_\+cr} & vertical chroma size\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the allocated Storable\+Picture structure 
\end{DoxyReturn}
\hypertarget{mbuffer_8c_a56f04e14a4e6ffb45cfa6f4aa3f8d9a9}{}\index{mbuffer.\+c@{mbuffer.\+c}!alloc\+\_\+frame\+\_\+store@{alloc\+\_\+frame\+\_\+store}}
\index{alloc\+\_\+frame\+\_\+store@{alloc\+\_\+frame\+\_\+store}!mbuffer.\+c@{mbuffer.\+c}}
\subsubsection[{alloc\+\_\+frame\+\_\+store()}]{\setlength{\rightskip}{0pt plus 5cm}Frame\+Store$\ast$ alloc\+\_\+frame\+\_\+store (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{mbuffer_8c_a56f04e14a4e6ffb45cfa6f4aa3f8d9a9}


Allocate memory for decoded picture buffer frame stores an initialize with sane values. 

\begin{DoxyReturn}{Returns}
the allocated Frame\+Store structure 
\end{DoxyReturn}
\hypertarget{mbuffer_8c_a548c12fb881b223ce2535bf0907af9e1}{}\index{mbuffer.\+c@{mbuffer.\+c}!alloc\+\_\+storable\+\_\+picture@{alloc\+\_\+storable\+\_\+picture}}
\index{alloc\+\_\+storable\+\_\+picture@{alloc\+\_\+storable\+\_\+picture}!mbuffer.\+c@{mbuffer.\+c}}
\subsubsection[{alloc\+\_\+storable\+\_\+picture(\+Picture\+Structure structure, int size\+\_\+x, int size\+\_\+y, int size\+\_\+x\+\_\+cr, int size\+\_\+y\+\_\+cr)}]{\setlength{\rightskip}{0pt plus 5cm}Storable\+Picture$\ast$ alloc\+\_\+storable\+\_\+picture (
\begin{DoxyParamCaption}
\item[{Picture\+Structure}]{structure, }
\item[{int}]{size\+\_\+x, }
\item[{int}]{size\+\_\+y, }
\item[{int}]{size\+\_\+x\+\_\+cr, }
\item[{int}]{size\+\_\+y\+\_\+cr}
\end{DoxyParamCaption}
)}\label{mbuffer_8c_a548c12fb881b223ce2535bf0907af9e1}


Allocate memory for a stored picture. 


\begin{DoxyParams}{Parameters}
{\em structure} & picture structure \\
\hline
{\em size\+\_\+x} & horizontal luma size \\
\hline
{\em size\+\_\+y} & vertical luma size \\
\hline
{\em size\+\_\+x\+\_\+cr} & horizontal chroma size \\
\hline
{\em size\+\_\+y\+\_\+cr} & vertical chroma size\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the allocated Storable\+Picture structure 
\end{DoxyReturn}
\hypertarget{mbuffer_8c_af05684dfb01eca59a30b057773f86113}{}\index{mbuffer.\+c@{mbuffer.\+c}!compute\+\_\+collocated@{compute\+\_\+collocated}}
\index{compute\+\_\+collocated@{compute\+\_\+collocated}!mbuffer.\+c@{mbuffer.\+c}}
\subsubsection[{compute\+\_\+collocated(\+Colocated\+Params $\ast$p, Storable\+Picture $\ast$$\ast$list\+X[6])}]{\setlength{\rightskip}{0pt plus 5cm}void compute\+\_\+collocated (
\begin{DoxyParamCaption}
\item[{Colocated\+Params $\ast$}]{p, }
\item[{Storable\+Picture $\ast$$\ast$}]{list\+X\mbox{[}6\mbox{]}}
\end{DoxyParamCaption}
)}\label{mbuffer_8c_af05684dfb01eca59a30b057773f86113}
Assign frame buffers for field M\+Bs Check whether we should use top or bottom field mvs. Depending on the assigned poc values.

Generate field M\+Vs from Frame M\+Vs

Do nothing if macroblock as field coded in M\+B-\/\+A\+F\+F

Need to consider interlace structure here

Use inference flag to remap mvs/references Frame with field co-\/located

Use inference flag to remap mvs/references \hypertarget{mbuffer_8c_a1020d2ddbd63e87f5b9f186fb2937c04}{}\index{mbuffer.\+c@{mbuffer.\+c}!dpb\+\_\+combine\+\_\+field@{dpb\+\_\+combine\+\_\+field}}
\index{dpb\+\_\+combine\+\_\+field@{dpb\+\_\+combine\+\_\+field}!mbuffer.\+c@{mbuffer.\+c}}
\subsubsection[{dpb\+\_\+combine\+\_\+field(\+Frame\+Store $\ast$fs)}]{\setlength{\rightskip}{0pt plus 5cm}void dpb\+\_\+combine\+\_\+field (
\begin{DoxyParamCaption}
\item[{Frame\+Store $\ast$}]{fs}
\end{DoxyParamCaption}
)}\label{mbuffer_8c_a1020d2ddbd63e87f5b9f186fb2937c04}


Generate a frame from top and bottom fields. 

Use inference flag to remap mvs/references

Generate Frame parameters from field information.

association with id already known for fields.

need to make association with frames

need to make association with frames \hypertarget{mbuffer_8c_a2b1e4bbf49d5c3eaf338c9431a8795c8}{}\index{mbuffer.\+c@{mbuffer.\+c}!dpb\+\_\+split\+\_\+field@{dpb\+\_\+split\+\_\+field}}
\index{dpb\+\_\+split\+\_\+field@{dpb\+\_\+split\+\_\+field}!mbuffer.\+c@{mbuffer.\+c}}
\subsubsection[{dpb\+\_\+split\+\_\+field(\+Frame\+Store $\ast$fs)}]{\setlength{\rightskip}{0pt plus 5cm}void dpb\+\_\+split\+\_\+field (
\begin{DoxyParamCaption}
\item[{Frame\+Store $\ast$}]{fs}
\end{DoxyParamCaption}
)}\label{mbuffer_8c_a2b1e4bbf49d5c3eaf338c9431a8795c8}


Extract top field from a frame. 

association with id already known for fields.

need to make association with frames

Generate field M\+Vs from Frame M\+Vs \hypertarget{mbuffer_8c_a5d12fb80e39e0072730217ee5083b51c}{}\index{mbuffer.\+c@{mbuffer.\+c}!fill\+\_\+frame\+\_\+num\+\_\+gap@{fill\+\_\+frame\+\_\+num\+\_\+gap}}
\index{fill\+\_\+frame\+\_\+num\+\_\+gap@{fill\+\_\+frame\+\_\+num\+\_\+gap}!mbuffer.\+c@{mbuffer.\+c}}
\subsubsection[{fill\+\_\+frame\+\_\+num\+\_\+gap(\+Image\+Parameters $\ast$img)}]{\setlength{\rightskip}{0pt plus 5cm}void fill\+\_\+frame\+\_\+num\+\_\+gap (
\begin{DoxyParamCaption}
\item[{Image\+Parameters $\ast$}]{img}
\end{DoxyParamCaption}
)}\label{mbuffer_8c_a5d12fb80e39e0072730217ee5083b51c}


Tian Dong June 13, 2002, Modifed on July 30, 2003. 

If a gap in frame\+\_\+num is found, try to fill the gap 
\begin{DoxyParams}{Parameters}
{\em img} & \\
\hline
\end{DoxyParams}
\hypertarget{mbuffer_8c_a45d036150b93760d3439e6507b2b7f45}{}\index{mbuffer.\+c@{mbuffer.\+c}!free\+\_\+collocated@{free\+\_\+collocated}}
\index{free\+\_\+collocated@{free\+\_\+collocated}!mbuffer.\+c@{mbuffer.\+c}}
\subsubsection[{free\+\_\+collocated(\+Colocated\+Params $\ast$p)}]{\setlength{\rightskip}{0pt plus 5cm}void free\+\_\+collocated (
\begin{DoxyParamCaption}
\item[{Colocated\+Params $\ast$}]{p}
\end{DoxyParamCaption}
)}\label{mbuffer_8c_a45d036150b93760d3439e6507b2b7f45}


Free co-\/located memory. 


\begin{DoxyParams}{Parameters}
{\em p} & Picture to be freed \\
\hline
\end{DoxyParams}
\hypertarget{mbuffer_8c_a6715a0198eeda7f13ee7c47c8070b6a1}{}\index{mbuffer.\+c@{mbuffer.\+c}!free\+\_\+frame\+\_\+store@{free\+\_\+frame\+\_\+store}}
\index{free\+\_\+frame\+\_\+store@{free\+\_\+frame\+\_\+store}!mbuffer.\+c@{mbuffer.\+c}}
\subsubsection[{free\+\_\+frame\+\_\+store(\+Frame\+Store $\ast$f)}]{\setlength{\rightskip}{0pt plus 5cm}void free\+\_\+frame\+\_\+store (
\begin{DoxyParamCaption}
\item[{Frame\+Store $\ast$}]{f}
\end{DoxyParamCaption}
)}\label{mbuffer_8c_a6715a0198eeda7f13ee7c47c8070b6a1}


Free frame store memory. 


\begin{DoxyParams}{Parameters}
{\em f} & Frame\+Store to be freed \\
\hline
\end{DoxyParams}
\hypertarget{mbuffer_8c_aa35eaa44fd3013b28c700490f5ed1ac9}{}\index{mbuffer.\+c@{mbuffer.\+c}!free\+\_\+storable\+\_\+picture@{free\+\_\+storable\+\_\+picture}}
\index{free\+\_\+storable\+\_\+picture@{free\+\_\+storable\+\_\+picture}!mbuffer.\+c@{mbuffer.\+c}}
\subsubsection[{free\+\_\+storable\+\_\+picture(\+Storable\+Picture $\ast$p)}]{\setlength{\rightskip}{0pt plus 5cm}void free\+\_\+storable\+\_\+picture (
\begin{DoxyParamCaption}
\item[{Storable\+Picture $\ast$}]{p}
\end{DoxyParamCaption}
)}\label{mbuffer_8c_aa35eaa44fd3013b28c700490f5ed1ac9}


Free picture memory. 


\begin{DoxyParams}{Parameters}
{\em p} & Picture to be freed \\
\hline
\end{DoxyParams}
\hypertarget{mbuffer_8c_a30268ef8c9ffd2a0bd884e31a9ce2322}{}\index{mbuffer.\+c@{mbuffer.\+c}!gen\+\_\+field\+\_\+ref\+\_\+ids@{gen\+\_\+field\+\_\+ref\+\_\+ids}}
\index{gen\+\_\+field\+\_\+ref\+\_\+ids@{gen\+\_\+field\+\_\+ref\+\_\+ids}!mbuffer.\+c@{mbuffer.\+c}}
\subsubsection[{gen\+\_\+field\+\_\+ref\+\_\+ids(\+Storable\+Picture $\ast$p)}]{\setlength{\rightskip}{0pt plus 5cm}void gen\+\_\+field\+\_\+ref\+\_\+ids (
\begin{DoxyParamCaption}
\item[{Storable\+Picture $\ast$}]{p}
\end{DoxyParamCaption}
)}\label{mbuffer_8c_a30268ef8c9ffd2a0bd884e31a9ce2322}
Generate Frame parameters from field information.

association with id already known for fields. \hypertarget{mbuffer_8c_a96a96f7b721d3ac5df4228496bc5a2eb}{}\index{mbuffer.\+c@{mbuffer.\+c}!init\+\_\+lists@{init\+\_\+lists}}
\index{init\+\_\+lists@{init\+\_\+lists}!mbuffer.\+c@{mbuffer.\+c}}
\subsubsection[{init\+\_\+lists(int curr\+Slice\+Type, Picture\+Structure curr\+Pic\+Structure)}]{\setlength{\rightskip}{0pt plus 5cm}void init\+\_\+lists (
\begin{DoxyParamCaption}
\item[{int}]{curr\+Slice\+Type, }
\item[{Picture\+Structure}]{curr\+Pic\+Structure}
\end{DoxyParamCaption}
)}\label{mbuffer_8c_a96a96f7b721d3ac5df4228496bc5a2eb}


Initialize list\+X\mbox{[}0\mbox{]} and list 1 depending on current picture type. 

初始化列表1和列表0 \hypertarget{mbuffer_8c_adf69a2ea97d75495124310f83b485be1}{}\index{mbuffer.\+c@{mbuffer.\+c}!replace\+\_\+top\+\_\+pic\+\_\+with\+\_\+frame@{replace\+\_\+top\+\_\+pic\+\_\+with\+\_\+frame}}
\index{replace\+\_\+top\+\_\+pic\+\_\+with\+\_\+frame@{replace\+\_\+top\+\_\+pic\+\_\+with\+\_\+frame}!mbuffer.\+c@{mbuffer.\+c}}
\subsubsection[{replace\+\_\+top\+\_\+pic\+\_\+with\+\_\+frame(\+Storable\+Picture $\ast$p)}]{\setlength{\rightskip}{0pt plus 5cm}void replace\+\_\+top\+\_\+pic\+\_\+with\+\_\+frame (
\begin{DoxyParamCaption}
\item[{Storable\+Picture $\ast$}]{p}
\end{DoxyParamCaption}
)}\label{mbuffer_8c_adf69a2ea97d75495124310f83b485be1}


Insert the frame picture into the if the top field has already been stored for the coding decision. 


\begin{DoxyParams}{Parameters}
{\em p} & Storable\+Picture to be inserted \\
\hline
\end{DoxyParams}
\hypertarget{mbuffer_8c_a1aa9e438cb3df3236e74bd1d8ca3c98f}{}\index{mbuffer.\+c@{mbuffer.\+c}!store\+\_\+picture\+\_\+in\+\_\+dpb@{store\+\_\+picture\+\_\+in\+\_\+dpb}}
\index{store\+\_\+picture\+\_\+in\+\_\+dpb@{store\+\_\+picture\+\_\+in\+\_\+dpb}!mbuffer.\+c@{mbuffer.\+c}}
\subsubsection[{store\+\_\+picture\+\_\+in\+\_\+dpb(\+Storable\+Picture $\ast$p)}]{\setlength{\rightskip}{0pt plus 5cm}void store\+\_\+picture\+\_\+in\+\_\+dpb (
\begin{DoxyParamCaption}
\item[{Storable\+Picture $\ast$}]{p}
\end{DoxyParamCaption}
)}\label{mbuffer_8c_a1aa9e438cb3df3236e74bd1d8ca3c98f}


Store a picture in D\+P\+B. This includes cheking for space in D\+P\+B and flushing frames. If we received a frame, we need to check for a new store, if we got a field, check if it\textquotesingle{}s the second field of an already allocated store. 


\begin{DoxyParams}{Parameters}
{\em p} & Picture to be stored \\
\hline
\end{DoxyParams}
